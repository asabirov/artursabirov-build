<!DOCTYPE html>
<html dir='ltr' lang='ru-RU'>
  <head>
    <meta charset='utf-8'>
    <title>Генераторы JSON для Rails — Блог Артура Сабирова</title>
    <link href='http://feeds.feedburner.com/artursabirov' rel='alternate' title='ArturSabirov.ru' type='application/rss+xml'>
    <link href="/stylesheets/blog.css" media="screen" rel="stylesheet" type="text/css" />
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <script charset='windows-1251' src='http://vkontakte.ru/js/api/openapi.js?29' type='text/javascript'></script>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="http://feeds.feedburner.com/artursabirov//dev" />
    <script>
      VK.init({apiId: 2348265, onlyWidgets: true});
    </script>
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-24946626-1']);
      _gaq.push(['_trackPageview']);
      
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body>
    <header>
      <section>
        <h1 id='page_heading'>
          <a href='/'>Блог Артура Сабирова</a>
        </h1>
        <nav>
          <a href="/dev">Разработка</a>
          <a href="/projects">Проекты</a>
          <a href="/books">Книги</a>
          <a href="/life">Жизнь</a>
          <a href="/about">О себе</a>
        </nav>
      </section>
    </header>
    <section id='single-column'>
      <article>
        <h1>Генераторы JSON для Rails</h1>
        <p>Сериализация объектов обычное явление в проектах Rails, для этих целей обычно используется сериализатор из ActiveSupport, но для составных контейнеров не очень удобен.</p>&#x000A;&#x000A;<h2 id="erb">Нативный ERB</h2>&#x000A;&#x000A;<p>Самый простой вариант.</p>&#x000A;&#x000A;<pre class="highlight ruby"><span class="k">class</span> <span class="nc">CountriesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>&#x000A;  <span class="k">def</span> <span class="nf">index</span>&#x000A;    <span class="vi">@counties</span> <span class="o">=</span> <span class="no">Country</span><span class="p">.</span><span class="nf">all</span>&#x000A;    <span class="n">respond_to</span> <span class="k">do</span> <span class="o">|</span><span class="nb">format</span><span class="o">|</span>&#x000A;      <span class="nb">format</span><span class="p">.</span><span class="nf">json</span> <span class="n">render</span> <span class="ss">:partial</span> <span class="o">=&gt;</span> <span class="s2">"countries/index.json"</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;&#x000A;<pre class="highlight ruby"><span class="o">&lt;</span><span class="sx">%- @countries.each do |country|%&gt;&#x000A;{&#x000A;    'name': '&lt;%= country.long_name %&gt;',&#x000A;    'code': '&lt;%= country.code %&gt;'&#x000A;}&#x000A;&lt;% end -%&gt;&#x000A;</span></pre>&#x000A;&#x000A;<p>Выбор старообрядцев.</p>&#x000A;&#x000A;<h2 id="rabl">RABL</h2>&#x000A;&#x000A;<p>Самый популярный на github.</p>&#x000A;&#x000A;<pre class="highlight ruby"><span class="n">gem</span> <span class="s2">"json_builder"</span>&#x000A;</pre>&#x000A;&#x000A;<pre class="highlight ruby"><span class="n">collection</span> <span class="vi">@posts</span>&#x000A;<span class="n">attributes</span> <span class="ss">:id</span><span class="p">,</span> <span class="ss">:title</span><span class="p">,</span> <span class="ss">:subject</span>&#x000A;<span class="n">child</span><span class="p">(</span><span class="ss">:user</span><span class="p">)</span> <span class="p">{</span> <span class="n">attributes</span> <span class="ss">:full_name</span> <span class="p">}</span>&#x000A;<span class="n">node</span><span class="p">(</span><span class="ss">:read</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span> <span class="n">post</span><span class="p">.</span><span class="nf">read_by?</span><span class="p">(</span><span class="vi">@user</span><span class="p">)</span> <span class="p">}</span>&#x000A;</pre>&#x000A;&#x000A;<p>http://localhost:3000/posts.json</p>&#x000A;&#x000A;<pre class="highlight json"><span class="p">[{</span><span class="w">  </span><span class="err">post</span><span class="w"> </span><span class="p">:</span><span class="w">&#x000A;  </span><span class="p">{</span><span class="w">&#x000A;    </span><span class="err">id</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="err">title</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w"> </span><span class="err">subject</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">&#x000A;    </span><span class="err">user</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="err">full_name</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="w"> </span><span class="p">},</span><span class="w">&#x000A;    </span><span class="err">read</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">&#x000A;  </span><span class="p">}</span><span class="w">&#x000A;</span><span class="p">}]</span><span class="w">&#x000A;</span></pre>&#x000A;&#x000A;<p>Rabl легко интегрируется в Sinatra и Padrino.</p>&#x000A;&#x000A;<p><a href="https://github.com/nesquena/rabl">https://github.com/nesquena/rabl</a></p>&#x000A;&#x000A;<h2 id="json-builder">JSON Builder</h2>&#x000A;&#x000A;<p>Второй по популярности.</p>&#x000A;&#x000A;<pre class="highlight plaintext">gem "json_builder"&#x000A;</pre>&#x000A;&#x000A;<p><br /></p>&#x000A;&#x000A;<pre class="highlight ruby"><span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>&#x000A;  <span class="n">respond_to</span> <span class="ss">:json</span>&#x000A;  &#x000A;  <span class="k">def</span> <span class="nf">index</span>&#x000A;    <span class="vi">@posts</span> <span class="o">=</span> <span class="no">Post</span><span class="p">.</span><span class="nf">all</span>&#x000A;    <span class="n">respond_with</span> <span class="vi">@posts</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;&#x000A;<pre class="highlight ruby"><span class="n">json</span><span class="p">.</span><span class="nf">posts</span> <span class="k">do</span>&#x000A;  <span class="n">json</span><span class="p">.</span><span class="nf">array!</span> <span class="vi">@posts</span> <span class="k">do</span>&#x000A;    <span class="vi">@posts</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>&#x000A;      <span class="n">json</span><span class="p">.</span><span class="nf">array_item!</span> <span class="k">do</span>&#x000A;        <span class="n">render</span> <span class="ss">:partial</span> <span class="o">=&gt;</span> <span class="s1">'post'</span><span class="p">,</span> <span class="ss">:locals</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:json</span> <span class="o">=&gt;</span> <span class="n">json</span><span class="p">,</span> <span class="ss">:post</span> <span class="o">=&gt;</span> <span class="n">post</span> <span class="p">}</span>&#x000A;      <span class="k">end</span>&#x000A;    <span class="k">end</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;&#x000A;<p>http://localhost:3000/posts.json</p>&#x000A;&#x000A;<pre class="highlight json"><span class="p">{</span><span class="w">&#x000A;  </span><span class="err">[posts]()</span><span class="w">&#x000A;</span><span class="err">[</span><span class="w">&#x000A;    </span><span class="err">{</span><span class="w">&#x000A;      </span><span class="err">id</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">&#x000A;      </span><span class="err">name</span><span class="p">:</span><span class="w"> </span><span class="s2">"Garrett Bjerkhoel"</span><span class="p">,</span><span class="w">&#x000A;      </span><span class="err">body</span><span class="p">:</span><span class="w"> </span><span class="s2">"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod."</span><span class="w">&#x000A;    </span><span class="p">}</span><span class="err">,</span><span class="w"> </span><span class="p">{</span><span class="w">&#x000A;      </span><span class="err">id</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">&#x000A;      </span><span class="err">name</span><span class="p">:</span><span class="w"> </span><span class="s2">"John Doe"</span><span class="p">,</span><span class="w">&#x000A;      </span><span class="err">body</span><span class="p">:</span><span class="w"> </span><span class="s2">"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod."</span><span class="w">&#x000A;    </span><span class="p">}</span><span class="w">&#x000A;  </span><span class="err">]</span><span class="w">&#x000A;</span><span class="err">}</span><span class="w">&#x000A;&#x000A;</span></pre>&#x000A;&#x000A;<p>Разработчик отмечает отличную скорость генерации. Только вот низкоуровневая работа с типами совсем не вызывает восторга.</p>&#x000A;&#x000A;<p><a href="https://github.com/dewski/json_builder">https://github.com/dewski/json_builder</a></p>&#x000A;&#x000A;<h2 id="jsonify">Jsonify</h2>&#x000A;&#x000A;<p>Совсем новый проект, стремительно набирающий популярность.</p>&#x000A;&#x000A;<pre class="highlight ruby"><span class="n">gem</span> <span class="s2">"jsonify-rails"</span>&#x000A;</pre>&#x000A;&#x000A;<pre class="highlight ruby"><span class="n">json</span><span class="p">.</span><span class="nf">post</span> <span class="k">do</span>&#x000A;  <span class="n">json</span><span class="p">.</span><span class="nf">title</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">title</span>&#x000A;  <span class="n">json</span><span class="p">.</span><span class="nf">body_plain</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">body_plain</span>&#x000A;  <span class="n">json</span><span class="p">.</span><span class="nf">body_html</span> <span class="vi">@post</span><span class="p">.</span><span class="nf">body</span>&#x000A;<span class="k">end</span>&#x000A;</pre>&#x000A;&#x000A;<p>http://localhost:3000/posts.json</p>&#x000A;&#x000A;<pre class="highlight json"><span class="p">{</span><span class="w">&#x000A;    </span><span class="err">post</span><span class="w"> </span><span class="p">:{</span><span class="w">&#x000A;        </span><span class="err">title</span><span class="p">:</span><span class="w"> </span><span class="s2">"..."</span><span class="p">,</span><span class="w">&#x000A;        </span><span class="err">body_plain</span><span class="p">:</span><span class="w">  </span><span class="s2">"..."</span><span class="p">,</span><span class="w">&#x000A;        </span><span class="err">body_html</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="w">&#x000A;    </span><span class="p">}</span><span class="w">&#x000A;</span><span class="p">}</span><span class="w">&#x000A;</span></pre>&#x000A;&#x000A;<p><a href="https://github.com/bsiggelkow/jsonify">https://github.com/bsiggelkow/jsonify</a></p>&#x000A;&#x000A;<p><a href="https://github.com/bsiggelkow/jsonify-rails">Wrapper для Rails — https://github.com/bsiggelkow/jsonify-rails</a></p>&#x000A;&#x000A;<h2 id="argonaut-tokamak--tequila">Argonaut, Tokamak и Tequila</h2>&#x000A;&#x000A;<p>Проекты скорее мертвые, чем просто «стабильные». Argonaut и Tokamak не совместимы с Rails 3.1. </p>&#x000A;&#x000A;<p><a href="https://github.com/abril/tokamak">https://github.com/abril/tokamak</a></p>&#x000A;&#x000A;<p><a href="https://github.com/jbr/argonaut">https://github.com/jbr/argonaut</a></p>&#x000A;&#x000A;<p><a href="http://inem.github.com/tequila.html">http://inem.github.com/tequila.html</a></p>&#x000A;&#x000A;<p>Мой выбор пал на jsonify, благодаря простому DSL.</p>
        <h4 class='meta'>
          09 Август 2011
          <div class='tags'>
            <a href="/dev/tags/rails/">rails</a>
          </div>
        </h4>
      </article>
      <footer>
        <!-- / -->
      </footer>
    </section>
    <script src="/javascripts/application.js" type="text/javascript"></script>
  </body>
</html>

