<!DOCTYPE html>
<html dir='ltr' lang='ru-RU'>
  <head>
    <meta charset='utf-8'>
    <title>Selenium Server на CentOS — Блог Артура Сабирова</title>
    <link href='http://feeds.feedburner.com/artursabirov' rel='alternate' title='ArturSabirov.ru' type='application/rss+xml'>
    <link href="/stylesheets/blog.css" media="screen" rel="stylesheet" type="text/css" />
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <script charset='windows-1251' src='http://vkontakte.ru/js/api/openapi.js?29' type='text/javascript'></script>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="http://feeds.feedburner.com/artursabirov//dev" />
    <script>
      VK.init({apiId: 2348265, onlyWidgets: true});
    </script>
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-24946626-1']);
      _gaq.push(['_trackPageview']);
      
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body>
    <header>
      <section>
        <h1 id='page_heading'>
          <a href='/'>Блог Артура Сабирова</a>
        </h1>
        <nav>
          <a href="/dev">Разработка</a>
          <a href="/projects">Проекты</a>
          <a href="/books">Книги</a>
          <a href="/life">Жизнь</a>
          <a href="/about">О себе</a>
        </nav>
      </section>
    </header>
    <section id='single-column'>
      <article>
        <h1>Selenium Server на CentOS</h1>
        <h2 id="section">Установка</h2>&#x000A;&#x000A;<p>Для начала потребуется виртуальный буфер для эмуляции иксов.</p>&#x000A;&#x000A;<pre class="highlight plaintext">yum install Xvfb&#x000A;&#x000A;</pre>&#x000A;&#x000A;<p>Скрипт автозагрузки:</p>&#x000A;&#x000A;<pre class="highlight shell"><span class="c">#!/bin/bash</span>&#x000A;<span class="c">#</span>&#x000A;<span class="c"># /etc/rc.d/init.d/xvfbd</span>&#x000A;<span class="c">#</span>&#x000A;<span class="c"># chkconfig: 345 95 28</span>&#x000A;<span class="c"># description: Starts/Stops X Virtual Framebuffer server</span>&#x000A;<span class="c"># processname: Xvfb</span>&#x000A;<span class="c">#</span>&#x000A;&#x000A;. /etc/init.d/functions&#x000A;&#x000A;<span class="o">[</span> <span class="s2">"</span><span class="k">${</span><span class="nv">NETWORKING</span><span class="k">}</span><span class="s2">"</span> <span class="o">=</span> <span class="s2">"no"</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nb">exit </span>0&#x000A;&#x000A;<span class="nv">PROG</span><span class="o">=</span><span class="s2">"Xvfb[&#x000A;PROG_OPTIONS=](7)&#x000A;-ac -screen 0 1024x768x24"</span>&#x000A;<span class="nv">PROG_OUTPUT</span><span class="o">=</span><span class="s2">"/tmp/Xvfb.out"</span>&#x000A;&#x000A;<span class="k">case</span> <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> <span class="k">in&#x000A;    </span>start<span class="p">)</span>&#x000A;        <span class="nb">echo</span> -n <span class="s2">"Starting : X Virtual Frame Buffer "</span>&#x000A;        <span class="nv">$PROG</span> <span class="nv">$PROG_OPTIONS</span>&gt;&gt;<span class="nv">$PROG_OUTPUT</span> 2&gt;&amp;1 &amp;&#x000A;        <span class="nb">disown</span> -ar&#x000A;        /bin/usleep 500000&#x000A;        status Xvfb &amp; &gt;/dev/null <span class="o">&amp;&amp;</span> echo_success <span class="o">||</span> echo_failure&#x000A;        <span class="nv">RETVAL</span><span class="o">=</span><span class="nv">$?</span>&#x000A;        <span class="k">if</span> <span class="o">[</span> <span class="nv">$RETVAL</span> -eq 0 <span class="o">]</span>; <span class="k">then</span>&#x000A;            /bin/touch /var/lock/subsys/Xvfb&#x000A;            /sbin/pidof -o  %PPID -x Xvfb &gt; /var/run/Xvfb.pid&#x000A;        <span class="k">fi&#x000A;        </span><span class="nb">echo</span>&#x000A;   		<span class="p">;;</span>&#x000A;    stop<span class="p">)</span>&#x000A;        <span class="nb">echo</span> -n <span class="s2">"Shutting down : X Virtual Frame Buffer"</span>&#x000A;        killproc <span class="nv">$PROG</span>&#x000A;        <span class="nv">RETVAL</span><span class="o">=</span><span class="nv">$?</span>&#x000A;        <span class="o">[</span> <span class="nv">$RETVAL</span> -eq 0 <span class="o">]</span> <span class="o">&amp;&amp;</span> /bin/rm -f /var/lock/subsys/Xvfb /var/run/Xvfb.pid&#x000A;        <span class="nb">echo</span>&#x000A;        <span class="p">;;</span>&#x000A;    restart|reload<span class="p">)</span>&#x000A;    	<span class="nv">$0</span> stop&#x000A;    	<span class="nv">$0</span> start&#x000A;        <span class="nv">RETVAL</span><span class="o">=</span><span class="nv">$?</span>&#x000A;      	<span class="p">;;</span>&#x000A;    status<span class="p">)</span>&#x000A;    	status Xvfb&#x000A;    	<span class="nv">RETVAL</span><span class="o">=</span><span class="nv">$?</span>&#x000A;    	<span class="p">;;</span>&#x000A;    <span class="k">*</span><span class="p">)</span>&#x000A;     <span class="nb">echo</span> <span class="s2">$"Usage: </span><span class="nv">$0</span><span class="s2"> (start|stop|restart|reload|status)"</span>&#x000A;     <span class="nb">exit </span>1&#x000A;<span class="k">esac&#x000A;&#x000A;</span><span class="nb">exit</span> <span class="nv">$RETVAL</span>&#x000A;&#x000A;</pre>&#x000A;&#x000A;<p>Добавим его в автозагрузку и запустим.</p>&#x000A;&#x000A;<pre class="highlight shell">chmod +x /etc/init.d/xvfb&#x000A;chkconfig xvfb on&#x000A;service xvfb start&#x000A;&#x000A;</pre>&#x000A;&#x000A;<p>Таперь Selenium Server.</p>&#x000A;&#x000A;<pre class="highlight shell">mkdir /usr/local/lib/selenium&#x000A;<span class="nb">cd</span> /usr/local/lib/selenium&#x000A;wget http://selenium.googlecode.com/files/selenium-server-standalone-2.4.0.jar&#x000A;mkdir -p /var/log/selenium/&#x000A;chmod a+w /var/log/selenium/&#x000A;&#x000A;</pre>&#x000A;&#x000A;<p>/etc/init.d/selenium</p>&#x000A;&#x000A;<pre class="highlight shell"><span class="c">#!/bin/bash</span>&#x000A;&#x000A;<span class="k">case</span> <span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="s1">''</span><span class="k">}</span><span class="s2">"</span> <span class="k">in</span>&#x000A;    <span class="s1">'start'</span><span class="p">)</span>&#x000A;        <span class="k">if </span><span class="nb">test</span> -f /tmp/selenium.pid&#x000A;        <span class="k">then&#x000A;            </span><span class="nb">echo</span> <span class="s2">"Selenium is already running."</span>&#x000A;        <span class="k">else&#x000A;            </span><span class="nv">DISPLAY</span><span class="o">=</span>:7 java -jar /usr/local/lib/selenium/selenium-server-standalone-2.4.0.jar -port 4444 &gt; /var/log/selenium/selenium-output.log 2&gt; /var/log/selenium/selenium-error.log &amp; <span class="nb">echo</span> <span class="nv">$!</span> &gt; /tmp/selenium.pid&#x000A;            <span class="nb">echo</span> <span class="s2">"Starting Selenium..."</span>&#x000A;&#x000A;            <span class="nv">error</span><span class="o">=</span><span class="nv">$?</span>&#x000A;            <span class="k">if </span><span class="nb">test</span> <span class="nv">$error</span> -gt 0&#x000A;            <span class="k">then&#x000A;                </span><span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">bon</span><span class="k">}</span><span class="s2">Error </span><span class="nv">$error</span><span class="s2">! Couldn't start Selenium!</span><span class="k">${</span><span class="nv">boff</span><span class="k">}</span><span class="s2">"</span>&#x000A;            echo_success&#x000A;            <span class="k">fi&#x000A;        fi</span>&#x000A;    <span class="p">;;</span>&#x000A;    <span class="s1">'stop'</span><span class="p">)</span>&#x000A;        <span class="k">if </span><span class="nb">test</span> -f /tmp/selenium.pid&#x000A;        <span class="k">then&#x000A;            </span><span class="nb">echo</span> <span class="s2">"Stopping Selenium..."</span>&#x000A;            <span class="nv">PID</span><span class="o">=</span><span class="sb">`</span>cat /tmp/selenium.pid<span class="sb">`</span>&#x000A;            <span class="nb">kill</span> -3 <span class="nv">$PID</span>&#x000A;            <span class="k">if </span><span class="nb">kill</span> -9 <span class="nv">$PID</span> ;&#x000A;                <span class="k">then&#x000A;                    </span>sleep 2&#x000A;                    <span class="nb">test</span> -f /tmp/selenium.pid <span class="o">&amp;&amp;</span> rm -f /tmp/selenium.pid&#x000A;                <span class="k">else&#x000A;                    </span><span class="nb">echo</span> <span class="s2">"Selenium could not be stopped..."</span>&#x000A;                <span class="k">fi&#x000A;        else&#x000A;            </span><span class="nb">echo</span> <span class="s2">"Selenium is not running."</span>&#x000A;        <span class="k">fi</span>&#x000A;        <span class="p">;;</span>&#x000A;    <span class="s1">'restart'</span><span class="p">)</span>&#x000A;       <span class="k">if </span><span class="nb">test</span> -f /tmp/selenium.pid&#x000A;        <span class="k">then&#x000A;            </span><span class="nb">kill</span> -HUP <span class="sb">`</span>cat /tmp/selenium.pid<span class="sb">`</span>&#x000A;            <span class="nb">test</span> -f /tmp/selenium.pid <span class="o">&amp;&amp;</span> rm -f /tmp/selenium.pid&#x000A;            sleep 1&#x000A;            java -jar /usr/local/lib/selenium/selenium-server-standalone-2.4.0.jar -port 4444 &gt; /var/log/selenium/selenium-output.log 2&gt; /var/log/selenium/selenium-error.log &amp; <span class="nb">echo</span> <span class="nv">$!</span> &gt; /tmp/selenium.pid&#x000A;            <span class="nb">echo</span> <span class="s2">"Reload Selenium..."</span>&#x000A;        <span class="k">else&#x000A;            </span><span class="nb">echo</span> <span class="s2">"Selenium isn't running..."</span>&#x000A;        <span class="k">fi</span>&#x000A;        <span class="p">;;</span>&#x000A;    <span class="k">*</span><span class="p">)</span>      <span class="c"># no parameter specified</span>&#x000A;        <span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$SELF</span><span class="s2"> start|stop|restart|reload|force-reload|status"</span>&#x000A;        <span class="nb">exit </span>1&#x000A;    <span class="p">;;</span>&#x000A;<span class="k">esac</span>&#x000A;&#x000A;</pre>&#x000A;&#x000A;<p>Запуск процесса:</p>&#x000A;&#x000A;<pre class="highlight shell">chmod +x /etc/init.d/selenium&#x000A;chkconfig selenium on&#x000A;service selenium start&#x000A;&#x000A;</pre>&#x000A;&#x000A;<p>Подключение FireFox:</p>&#x000A;&#x000A;<pre class="highlight shell"><span class="nb">cd</span> /tmp&#x000A;wget http://mirror.informatik.uni-mannheim.de/pub/mirrors/mozilla.org/firefox/releases/6.0/linux-i686/en-US/firefox-6.0.tar.bz2&#x000A;tar xvf firefox-6.0.tar.bz2&#x000A;mv firefox /usr/local/firefox-6.0&#x000A;ln -s /usr/local/firefox-6.0/firefox /usr/local/bin/firefox&#x000A;&#x000A;</pre>&#x000A;&#x000A;<h2 id="section-1">Результат</h2>&#x000A;&#x000A;<p>Пример скрипта:</p>&#x000A;&#x000A;<pre class="highlight ruby"><span class="nb">require</span> <span class="s1">'rubygems'</span>&#x000A;<span class="n">gem</span> <span class="s2">"selenium-client"</span>&#x000A;<span class="nb">require</span> <span class="s2">"selenium/client"</span>&#x000A;<span class="vi">@selenium_driver</span> <span class="o">=</span> <span class="no">Selenium</span><span class="o">::</span><span class="no">Client</span><span class="o">::</span><span class="no">Driver</span><span class="p">.</span><span class="nf">new</span> <span class="p">\</span>&#x000A;  <span class="ss">:host</span> <span class="o">=&gt;</span> <span class="s2">"localhost"</span><span class="p">,</span>&#x000A;  <span class="ss">:port</span> <span class="o">=&gt;</span> <span class="mi">4444</span><span class="p">,</span>&#x000A;  <span class="ss">:browser</span> <span class="o">=&gt;</span> <span class="s2">"*firefox"</span><span class="p">,</span>&#x000A;  <span class="ss">:url</span> <span class="o">=&gt;</span> <span class="s2">"http://html5test.com/"</span><span class="p">,</span>&#x000A;  <span class="ss">:timeout_in_seconds</span> <span class="o">=&gt;</span> <span class="mi">10</span>&#x000A;<span class="vi">@selenium_driver</span><span class="p">.</span><span class="nf">start_new_browser_session</span>&#x000A;<span class="vi">@selenium_driver</span><span class="p">.</span><span class="nf">open</span> <span class="s2">"/"</span>&#x000A;<span class="vi">@selenium_driver</span><span class="p">.</span><span class="nf">capture_entire_page_screenshot</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">dirname</span><span class="p">(</span><span class="kp">__FILE__</span><span class="p">))</span> <span class="o">+</span> <span class="s1">'screenshot.png'</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>&#x000A;<span class="vi">@selenium_driver</span><span class="p">.</span><span class="nf">stop</span>&#x000A;&#x000A;</pre>&#x000A;&#x000A;<pre class="highlight shell">gem install selenium-client&#x000A;ruby test.rb&#x000A;</pre>&#x000A;&#x000A;<h2 id="section-2">Резюме</h2>&#x000A;&#x000A;<p>Серверный selenium легко подключается к rspec и либо CI. Предоставляет больший выбор браузеров, нежели phantomjs.</p>&#x000A;&#x000A;<p>Стоит сразу посмотреть <a href="http://selenium-grid.seleniumhq.org/.">Selenium Grid</a>&#x000A;Он предназначен для распределенного по нескольким серверам тестирования.</p>
        <h4 class='meta'>
          <div class='tags'>
            <a href="/dev/tags/тестирование/">тестирование</a>
          </div>
        </h4>
      </article>
    </section>
    <script src="/javascripts/application.js" type="text/javascript"></script>
  </body>
</html>

